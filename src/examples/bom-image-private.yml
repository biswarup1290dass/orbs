description: >
    Create SBOM for image hosted on private registry.
    Use `docker login` to add access.

usage:
  version: 2.1
  orbs:
    scribe: scribe-security/orbs@x.y.z

  workflows:
    private-image:
      jobs:
        - checkout

        # Install scribe tool
        - scribe/install

        - setup_remote_docker:
            docker_layer_caching: true

        - run:
            name: Publish Docker Image to Docker Hub
            command: |
              echo "$DOCKERHUB_PASS" | docker login -u "$DOCKERHUB_USERNAME" --password-stdin

        # Docker build,push ..

        - scribe/bom:
            target: scribesecuriy.jfrog.io/scribe-docker-local/stub_remote:latest
            output-file: my_sbom.json
            force: true

        # Storing as artifacts
        - store_artifacts:
            path: scribe/
            destination: scribe-evidence
