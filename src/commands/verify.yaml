description: Verify target by BOM attestation
parameters:
  target:
    description: Verify target by BOM attestation
    default: ""
    type: string
  config:
    description: Application config file
    default: ""
    type: string
  inputformat:
    description: Sbom input formatter, options=[attest-cyclonedx-json]
    default: attest-cyclonedx-json
    type: string
  output-directory:
    description: Report output directory
    default: ./scribe/gensbom
    type: string
  output-file:
    description: Output result to file
    default: ""
    type: string
  verbose:
    description: Increase verbosity (-v = info, -vv = debug)
    default: 2
    type: integer
  attest-config:
    description: 'Attestation config map'
    default: ""
    type: string
  attest-name:
    description: 'Attestation config name (default "gensbom")'
    default: ""
    type: string
  attest-default:
    description: 'Attestation default config, options=[sigstore sigstore-github x509]'
    default: ""
    type: string
  scribe-enable:
    description: 'Enable scribe client'
    default: false
    type: boolean
  scribe-client-id:
    description: 'Scribe client id'
    type: string
    default: ""
  scribe-client-secret:
    description: 'Scribe access token'
    type: string
    default: ""
  scribe-url:
    description: 'Scribe url'
    type: string
    default: ""
  scribe-login-url:
    description: 'Scribe auth login url'
    type: string
    default: ""
  scribe-audience:
    description: 'Scribe auth audience'
    type: string
    default: ""

steps:
- run:
    name: Verify target by BOM attestation
    command: gensbom verify << parameters.target >> \
      <<# parameters.config >>--config << parameters.config >><</ parameters.config >> \
      <<# parameters.inputformat >>--inputformat << parameters.inputformat >><</ parameters.inputformat >> \
      <<# parameters.output-directory >>--output-directory << parameters.output-directory >><</ parameters.output-directory >> \
      <<# parameters.output-file >>--output-file << parameters.output-file >><</ parameters.output-file >> \
      <<# parameters.attest-config >>--attest.config << parameters.attest-config >><</ parameters.attest-config >> \
      <<# parameters.attest-name >>--attest.name << parameters.attest-name >><</ parameters.attest-name >> \
      <<# parameters.attest-default >>--attest.default << parameters.attest-default >><</ parameters.attest-default >> \
      <<# parameters.scribe-client-id >>--scribe.client-id << parameters.scribe-client-id >><</ parameters.scribe-client-id  >> \
      <<# parameters.scribe-client-secret >>--scribe.client-secret << parameters.scribe-client-secret >><</ parameters.scribe-client-secret  >> \
      <<# parameters.scribe-enable  >>--scribe.enable << parameters.scribe-enable >><</ parameters.scribe-enable  >> \
      <<# parameters.scribe-url  >>--scribe.url << parameters.scribe-url >><</ parameters.scribe-url  >> \
      <<# parameters.scribe-audience  >>--scribe.auth0.audience << parameters.scribe-audience >><</ parameters.scribe-audience  >> \
      <<# parameters.scribe-login-url  >>--scribe.auth0.login-url << parameters.scribe-login-url >><</ parameters.scribe-login-url  >>
      #  - --context-type=circleci 2DO add support for circleci context.
