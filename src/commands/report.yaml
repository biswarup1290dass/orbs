description: download report from scribe service
parameters:
  config:
    description: Config of the application
    default: ""
    type: string
  context-type:
    description: Context type, options=[jenkins github local]
    default: local
    type: string
  integrity:
    description: Select report integrity, options=[Modified Not_Covered Validated Not_Validated]
    default: ""
    type: string
  output-directory:
    description: Output directory path
    default: ./scribe/valint
    type: string
  output-file:
    description: Output file path
    default: ""
    type: string
  scribe-enable:
    description: 'Enable scribe client'
    default: false
    type: boolean
  scribe-client-id:
    description: 'Scribe client id'
    type: string
    default: ""
  scribe-client-secret:
    description: 'Scribe access token'
    type: string
    default: ""
  scribe-url:
    description: 'Scribe url'
    type: string
    default: ""
  scribe-login-url:
    description: 'Scribe auth login url'
    type: string
    default: ""
  scribe-audience:
    description: 'Scribe auth audience'
    type: string
    default: ""
  section:
    description: Select report sections, options=[files packages packages-files summary stat]
    type: string
    default: ""
  verbose:
    description: Increase verbosity (-v = info, -vv = debug)
    default: 1
    type: integer
  timeout:
    description: Timeout duration
    default: 60s
    type: string
  backoff:
    description: Backoff duration
    default: 5s
    type: string
steps:
- run:
    name: download report from scribe service
    command: |
      valint report \
        <<# parameters.integrity >>--integrity << parameters.integrity >><</ parameters.integrity >> \
        <<# parameters.section >>--section << parameters.section >><</ parameters.section >> \
        <<# parameters.config >>--config << parameters.config >><</ parameters.config >> \
        <<# parameters.output-directory >>--output-directory << parameters.output-directory >><</ parameters.output-directory >> \
        <<# parameters.output-file >>--output-file << parameters.output-file >><</ parameters.output-file >> \
        <<# parameters.scribe-client-id >>--scribe.client-id << parameters.scribe-client-id >><</ parameters.scribe-client-id  >> \
        <<# parameters.scribe-client-secret >>--scribe.client-secret << parameters.scribe-client-secret >><</ parameters.scribe-client-secret  >> \
        <<# parameters.scribe-enable  >>--scribe.enable << parameters.scribe-enable >><</ parameters.scribe-enable  >> \
        <<# parameters.scribe-url  >>--scribe.url << parameters.scribe-url >><</ parameters.scribe-url  >> \
        <<# parameters.scribe-audience  >>--scribe.auth.audience << parameters.scribe-audience >><</ parameters.scribe-audience  >> \
        <<# parameters.scribe-login-url  >>--scribe.login-url << parameters.scribe-login-url >><</ parameters.scribe-login-url  >> \
        <<# parameters.verbose >>--verbose << parameters.verbose >><</ parameters.verbose >> \
        <<# parameters.timeout >>--timeout << parameters.timeout >><</ parameters.timeout >> \
        <<# parameters.backoff >>--backoff << parameters.backoff >><</ parameters.backoff >>
